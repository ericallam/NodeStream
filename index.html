<html>
<head>
  <title>NodeStream</title>
  <script type="text/javascript" src="jquery-1.4.2.min.js"></script> >
  <script type="text/javascript" src="javascripts/swfobject.js"></script>
  <script type="text/javascript" src="javascripts/FABridge.js"></script>
  <script type="text/javascript" src="javascripts/web_socket.js"></script>
  
  <script type="text/javascript">
    $(function() {      
      var webSocket = new WebSocket("ws://localhost:8080/userstream"),
          buffer = "",
          friends = [];
      
      webSocket.onopen = function(event){
        $("#status").html("connecting...");
        webSocket.send('start');
      };

      webSocket.onmessage = function(event){
        var object;
        try {
          object = JSON.parse(event.data);
          console.log(object);
          if(object.friends) {
            friends = object.friends;
            $("#stream").append("<li>Loaded friends..."+friends+"</li>");
          } else {
            $("#stream").append("<li>"+event.data+"</li>");
          }
          buffer = "";
        } catch(e) {
          buffer += event.data;
        }
      };

      webSocket.onclose = function(event){
        $("#status").html("not connected");
      };    
    });
  </script>


  </script>
</head>

  <h2>Stream</h2>
  <span id="status">Not connected...</span>
  <ul id="stream"></ul>
</html>